# Backend Seeding Data - Polls

## Overview

This directory contains clean, complete seed data for the JevahApp Community polls feature. The data is structured to match the backend API requirements exactly.

## File Structure

- `polls-seed-data.json` - Complete poll seed data with all required fields and options

## Usage

### For Backend Developers

1. **Import the JSON file** into your seeding script
2. **Validate the data** against the schema requirements
3. **Generate IDs**: Backend should generate unique `_id` for:
   - Each poll
   - Each option within each poll
4. **Populate user fields**: Set `createdBy` to admin user ID and populate `createdByUser`
5. **Calculate active status**: Set `isActive` based on `expiresAt` vs current date
6. **Initialize vote counts**: Set `votesCount` and `percentage` to 0 for new polls

### Example Seeding Code (Node.js/MongoDB)

```javascript
const pollsData = require('./polls-seed-data.json');
const { ObjectId } = require('mongodb');

async function seedPolls() {
  const adminUser = await User.findOne({ role: 'admin' });
  
  for (const pollData of pollsData.polls) {
    // Generate poll ID
    const pollId = new ObjectId();
    
    // Generate option IDs
    const options = pollData.options.map(option => ({
      _id: new ObjectId(),
      text: option.text,
      votesCount: option.votesCount || 0,
      percentage: option.percentage || 0
    }));
    
    // Calculate isActive
    const isActive = pollData.expiresAt 
      ? new Date(pollData.expiresAt) > new Date()
      : true;
    
    // Create poll document
    const poll = {
      _id: pollId,
      title: pollData.title,
      question: pollData.question || pollData.title,
      description: pollData.description,
      createdBy: adminUser._id,
      options: options,
      totalVotes: 0, // Sum of all option votesCount
      multiSelect: pollData.multiSelect || false,
      expiresAt: pollData.expiresAt ? new Date(pollData.expiresAt) : null,
      isActive: isActive,
      createdAt: new Date(),
      updatedAt: new Date(),
      createdByUser: {
        _id: adminUser._id,
        username: adminUser.username,
        firstName: adminUser.firstName,
        lastName: adminUser.lastName,
        avatarUrl: adminUser.avatarUrl
      }
    };
    
    await Poll.create(poll);
  }
  
  // Also seed expired polls if provided
  if (pollsData.expiredPolls) {
    for (const pollData of pollsData.expiredPolls) {
      // Same process as above, but with existing vote counts
      // ...
    }
  }
}
```

## Data Structure

### Poll Object

```typescript
{
  _id: string,                    // Generated by backend
  title: string,                   // Required: Poll question/title
  question: string,                // Required: Should match title
  description?: string,            // Optional description
  createdBy: string,               // Admin user ID (set by backend)
  options: Array<{
    _id: string,                   // Generated by backend
    text: string,                  // Required: Option text
    votesCount: number,            // Initialize to 0
    percentage: number             // Initialize to 0
  }>,
  totalVotes: number,              // Sum of option votesCount
  multiSelect: boolean,           // Default: false
  expiresAt?: string,             // ISO 8601 date string
  isActive: boolean,              // Calculated: expiresAt > now
  createdAt: string,              // ISO 8601 date string
  createdByUser: {                // Populated by backend
    _id: string,
    username: string,
    firstName?: string,
    lastName?: string,
    avatarUrl?: string
  }
}
```

## Validation Checklist

Before seeding, ensure:

- [ ] All polls have `title` and `question` fields
- [ ] All polls have `options` array with minimum 2 options
- [ ] No poll has more than 10 options
- [ ] All option objects have `text` field
- [ ] All dates are in ISO 8601 format (YYYY-MM-DDTHH:mm:ss.sssZ)
- [ ] `expiresAt` dates are in the future for active polls
- [ ] `multiSelect` is boolean (true/false)
- [ ] Backend generates unique `_id` for polls and options
- [ ] Backend sets `createdBy` to admin user ID
- [ ] Backend populates `createdByUser` from admin user document

## Notes

- **Options are required**: Every poll MUST have at least 2 options
- **Text field is required**: Each option MUST have a `text` field
- **Backend generates IDs**: Frontend provides text, backend generates ObjectIds
- **Active status**: Backend calculates `isActive` from `expiresAt`
- **Vote counts**: Initialize to 0 for new polls, use provided values for expired polls

## Questions?

If you encounter issues with the seed data structure, refer to:
- `COMMUNITY_BACKEND_API_DOCUMENTATION.md` - Full API documentation
- Backend API endpoint: `GET /api/community/polls` - See expected response format

